/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package anaphoraresolution;
import java.util.Iterator;
import java.util.Map;
import java.util.Properties;
import edu.stanford.nlp.dcoref.CorefChain;
import edu.stanford.nlp.dcoref.CorefCoreAnnotations.CorefChainAnnotation;
import edu.stanford.nlp.pipeline.Annotation;
import edu.stanford.nlp.pipeline.StanfordCoreNLP;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.TreeSet;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author shubhang
 */
public class MainScreen extends javax.swing.JFrame {

    /**
     * Creates new form MainScreen
     */
    public MainScreen() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jFileChooser1 = new javax.swing.JFileChooser();
        jTextField1 = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jTextField4 = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextArea1 = new javax.swing.JTextArea();
        jLabel4 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTextArea2 = new javax.swing.JTextArea();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jLabel1.setFont(new java.awt.Font("Ubuntu", 0, 24)); // NOI18N
        jLabel1.setText("Anaphora Resolution");

        jFileChooser1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jFileChooser1ActionPerformed(evt);
            }
        });

        jTextField1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField1ActionPerformed(evt);
            }
        });

        jLabel2.setText("Story Name");

        jLabel3.setText("Characters : ");

        jLabel5.setText("Main Character :");

        jTextField4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField4ActionPerformed(evt);
            }
        });

        jTextArea1.setColumns(20);
        jTextArea1.setRows(5);
        jScrollPane1.setViewportView(jTextArea1);

        jLabel4.setText("References :");

        jTextArea2.setColumns(20);
        jTextArea2.setRows(5);
        jScrollPane2.setViewportView(jTextArea2);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(26, 26, 26)
                .addComponent(jFileChooser1, javax.swing.GroupLayout.PREFERRED_SIZE, 421, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTextField4))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 135, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, 257, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 192, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel3)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 191, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(24, 24, 24)))
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addGap(324, 324, 324)
                .addComponent(jLabel1)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 18, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel2)
                            .addComponent(jTextField4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(14, 14, 14)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel5)
                            .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, 24, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 25, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel4))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 241, Short.MAX_VALUE)
                            .addComponent(jScrollPane2)))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jFileChooser1, javax.swing.GroupLayout.PREFERRED_SIZE, 348, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 23, Short.MAX_VALUE)))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jTextField1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField1ActionPerformed

    private void jFileChooser1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jFileChooser1ActionPerformed
        try {
            // TODO add your handling code here:
            jTextArea1.setText("");
            String name = jFileChooser1.getSelectedFile().getName();//.replace(".html","");
            System.out.println(name.replace(".txt",""));
            jTextField4.setText(name);
            
            File file = jFileChooser1.getSelectedFile();
            BufferedReader br = null;
            try {
                br = new BufferedReader(new FileReader(file.getPath()));
            } catch (FileNotFoundException ex) {
                Logger.getLogger(MainScreen.class.getName()).log(Level.SEVERE, null, ex);
            }
            //String text = "Long ago, there was a farmer who had an old horse with him. As the horse had become old, the farmer told the horse to leave his house and live in some forest. The horse became very sad. He said to his master,  Master, Im your old servant. I have served you all my life. I have always been faithful to you and there has been no slackness on my part in carrying out my duties. So long as I was physically strong, you had all your affections for me but as soon as you realised that I have become physically infirm; I, no longer, have that vigour and vitality in me, you asked me to leave your house and go and live in some forest. Is this a reward to the services rendered by me with all my honesty and faithfulness?  The farmer was at a loss of words. He had no logical answer.  All right!  the farmer said to the horse.  You can stay in my house provided you bring me a lion. I want a lions skin.  So the worried horse set out for the forest. There he met a fox. The fox took pity on the horse and enquired from him the reason of his sadness. The horse narrated the whole story. The fox being good natured offered to help the horse. He said to the horse.  You lie down here on the ground as if you were dead.  The horse followed the advice of the fox and lay there on the ground as if he were dead. Then the fox met king lion and said  Your Majesty, there is a dead horse lying in an open field. Its better you come and see for yourself.  When the fox and the lion reached the spot, where the horse was lying pretending to be dead, the fox said,  Let us pull this horse and put it behind the bushes so that we could have a peaceful meal. What Ill do is that Ill tie your tail to the tail of the horse.   Yes, I agree with you,  said the lion. So the fox, instead of tying lions tail to that of the horse, tied the horses tail with the leg of the lion. Then he asked the horse to get up and run fast. The horse, at once got up and started running as fast as he could. All this happened so suddenly that the lion didnt get a chance to balance himself. The horse was running so fast that he was literally being dragged like a dead animal. His body slammed against big rocks so many times and was caught by thorny bushes in the way. He was getting injuries after injuries and was bleeding profusely. The lion began to cry and threaten, but the horse didnt stop. At last, the lion couldnt take any more of it and succumbed to injuries. The horse stopped at his masters house with the dead lion tied to its tail. The farmer was very happy to see the dead lion. He permitted the horse to stay at his house as long as he wished.";
            String text = br.readLine();
            Annotation document = new Annotation(text);
            Properties props = new Properties();
            props.put("annotators", "tokenize, ssplit, pos, parse, lemma, ner, dcoref");
            StanfordCoreNLP pipeline = new StanfordCoreNLP(props);
            pipeline.annotate(document);
            //props.put("oldCorefFormat", "true");
            Map<Integer, CorefChain> graph = document.get(CorefChainAnnotation.class);
            //System.out.println(graph.);
            Iterator it=graph.entrySet().iterator();
            int max=0;
            String[] max_name = null;
            while(it.hasNext())
              {
                      String st = it.next().toString();
                       if(!st.contains(","))
                                continue;
                        //System.out.println(st);
                        String s[] = st.split("\"");
                        int count=0;
                        for(int i=1;i<s.length;i=i+2)
                        {
                                //System.out.print(s[i]+" ");
                                count++;
                        }
                        
                        int count2=0;
                        String[] st2;
                        String max2[] = new String[(s.length+1)/2];
                        for(int l=1;l<s.length;l=l+2)
                        {
                            max2[count2++] = s[l];
                        }
                        OpenNlp1 op2 = new OpenNlp1();
                        st2 = op2.main1(max2); 
                        //for(int j=0;j<st2.length;j++)
                        //System.out.println("Characters : "+st2[j]);
                        try{
                        String st3 = st2[0];
                        String st4 = jTextArea1.getText();
                        jTextArea1.setText(st4+"\n"+st3);
                        }
                        catch(Exception e)
                        {
                            
                            //jTextArea1.setText(jTextArea1.getText()+"\n"+max2[0]);
                        }
                        if(count>=max)
                        {
                                max = count;
                                max_name = s;
                        }
                        //System.out.println();
                }
                //String st="";
                OpenNlp op = new OpenNlp();
                String st[] =null;
                String[] max1 = null;
                int count1=0;
                max1 = new String[(max_name.length+1)/2];
                for(int l=1;l<max_name.length;l=l+2)
                {
                    max1[count1++] = max_name[l];
                }
                st = op.main1(max1);
                
                
                
                /*for(int i=1;i<max_name.length;i=i+2)
                {
                           st = max_name[1];
                           Op
                        //System.out.println(max_name[i]);
                }*/
                try{
                    jTextField1.setText(st[0]);
                    jTextArea2.setText("");
                    for(int i=0;i<st.length;i++)
                    {
                        if(st[i]==null)
                            continue;
                        jTextArea2.setText(jTextArea2.getText()+"\n"+st[i]);
                    }
                }
                catch(Exception e)
                {
                    jTextField1.setText(max_name[1]);
                    jTextArea2.setText("");
                    ArrayList<String> ts = new ArrayList();
                    for(int i=0;i<max1.length;i++)
                    {
                        if(max1[i]==null) {
                        } else {
                            ts.add(max1[i]);
                            //ts.add(max1[i].toLowerCase());
                        }
                    }
                    for(int i=0;i<ts.size();i++)
                    {
                        
                        jTextArea2.setText(jTextArea2.getText()+"\n"+ts.remove(i));
                    }
                }
            //System.out.println(file.getPath());
        } catch (IOException ex) {
            Logger.getLogger(MainScreen.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_jFileChooser1ActionPerformed

    private void jTextField4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField4ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField4ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(MainScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(MainScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(MainScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(MainScreen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new MainScreen().setVisible(true);
            }
        });
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JFileChooser jFileChooser1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTextArea jTextArea1;
    private javax.swing.JTextArea jTextArea2;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField4;
    // End of variables declaration//GEN-END:variables
}
